name: Minimal ML Heating Validation

on:
  push:
    branches: [main]
  pull_request:
    branches: [main]
  workflow_dispatch:

jobs:
  basic-check:
    runs-on: ubuntu-latest
    name: Basic Repository Check
    
    steps:
      - name: Checkout
        uses: actions/checkout@v4
        
      - name: Check files exist
        run: |
          echo "Checking required files..."
          
          if [ -f "ml_heating_addon/config.yaml" ]; then
            echo "‚úÖ config.yaml exists"
          else
            echo "‚ùå config.yaml missing"
            exit 1
          fi
          
          if [ -f "ml_heating_addon/build.json" ]; then
            echo "‚úÖ build.json exists"
          else
            echo "‚ùå build.json missing"
            exit 1
          fi
          
          if [ -f "ml_heating_addon/Dockerfile" ]; then
            echo "‚úÖ Dockerfile exists"
          else
            echo "‚ùå Dockerfile missing"
            exit 1
          fi
          
          if [ -f "repository.json" ]; then
            echo "‚úÖ repository.json exists"
          else
            echo "‚ùå repository.json missing"  
            exit 1
          fi
          
          echo "üéâ All required files present!"

  yaml-check:
    runs-on: ubuntu-latest
    name: YAML Syntax Check
    
    steps:
      - name: Checkout
        uses: actions/checkout@v4
        
      - name: Setup Python
        uses: actions/setup-python@v4
        with:
          python-version: '3.11'
          
      - name: Install PyYAML
        run: pip install pyyaml
        
      - name: Validate config.yaml
        run: |
          echo "Validating config.yaml syntax..."
          python3 -c "import yaml; yaml.safe_load(open('ml_heating_addon/config.yaml'))"
          echo "‚úÖ config.yaml is valid YAML"

  json-check:
    runs-on: ubuntu-latest 
    name: JSON Syntax Check
    
    steps:
      - name: Checkout
        uses: actions/checkout@v4
        
      - name: Validate JSON files
        run: |
          echo "Validating JSON syntax..."
          
          # Check build.json
          python3 -c "import json; json.load(open('ml_heating_addon/build.json'))"
          echo "‚úÖ build.json is valid JSON"
          
          # Check repository.json
          python3 -c "import json; json.load(open('repository.json'))"
          echo "‚úÖ repository.json is valid JSON"

  summary:
    runs-on: ubuntu-latest
    needs: [basic-check, yaml-check, json-check]
    name: Validation Summary
    
    steps:
      - name: Report success
        run: |
          echo "üéâ All validations passed!"
          echo "‚úÖ Required files present"
          echo "‚úÖ YAML syntax valid"
          echo "‚úÖ JSON syntax valid"
          echo ""
          echo "ML Heating Add-on structure is valid!"
