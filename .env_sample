# ML Heating configuration Sample
# Copy this file to .env and set your actual values.
# Keep tokens and sensitive information secret; do NOT commit your .env file to version control.

# --- Home Assistant ---
# Base URL of your Home Assistant instance (e.g., http://homeassistant.local:8123)
HASS_URL=https://home-assistant.example.com

# A Long-Lived Access Token from your Home Assistant profile page.
HASS_TOKEN=YOUR_HOME_ASSISTANT_TOKEN

# --- InfluxDB ---
# URL of your InfluxDB instance, including the protocol and port.
INFLUX_URL=https://influxdb.example.com:8086

# An InfluxDB API token with read access to the specified bucket.
INFLUX_TOKEN=YOUR_INFLUXDB_TOKEN

# The InfluxDB organization and bucket where your Home Assistant data is stored.
INFLUX_ORG=your-org
INFLUX_BUCKET=home_assistant/autogen

# --- Model and State ---
# Absolute path to store the trained machine learning model file.
MODEL_FILE=/opt/ml_heating/ml_model.pkl

# Absolute path to store the last state (features) for online learning.
STATE_FILE=/opt/ml_heating/ml_state.pkl

# --- Script Behavior ---
# Number of historical steps to use as features for the model.
HISTORY_STEPS=6

# The duration of each historical step in minutes.
HISTORY_STEP_MINUTES=10

# How many 5-minute steps into the future the model should predict.
# Example: 24 means 24 * 5min = 120 minutes ahead.
PREDICTION_HORIZON_STEPS=24

# --- Home Assistant Entity IDs ---
# These must match the entity IDs in your Home Assistant instance.

# An input_number or sensor that holds the target indoor temperature.
TARGET_INDOOR_TEMP_ENTITY_ID=input_number.hp_auto_correct_target

# The primary indoor temperature sensor.
INDOOR_TEMP_ENTITY_ID=sensor.your_indoor_temp_sensor

# The heat pump's outlet temperature sensor.
ACTUAL_OUTLET_TEMP_ENTITY_ID=sensor.your_hp_outlet_temp

# A binary sensor that is 'on' when Domestic Hot Water (DHW) is being heated.
DHW_STATUS_ENTITY_ID=binary_sensor.your_dhw_status_sensor

# A binary sensor that is 'on' during a defrost cycle.
DEFROST_STATUS_ENTITY_ID=binary_sensor.hp_defrosting_status

# A binary sensor that is 'on' during a DHW tank disinfection cycle.
DISINFECTION_STATUS_ENTITY_ID=binary_sensor.hp_dhw_tank_disinfection_status

# A binary sensor that is 'on' when the DHW boost heater is active.
DHW_BOOST_HEATER_STATUS_ENTITY_ID=binary_sensor.hp_dhw_boost_heater_status

# A sensor or helper (e.g., input_boolean) that indicates if a TV or other significant heat source is on.
TV_STATUS_ENTITY_ID=input_boolean.your_tv_status

# The outdoor temperature sensor, preferably compensated or near the heat pump.
OUTDOOR_TEMP_ENTITY_ID=sensor.your_outdoor_temp_sensor

# The climate entity for your heating system, used to check if it's in the 'heat' state.
HEATING_STATUS_ENTITY_ID=climate.your_heating_entity

# An external weather forecast temperature sensor (e.g., from OpenWeatherMap).
OPENWEATHERMAP_TEMP_ENTITY_ID=sensor.openweathermap_temperature

# --- PV (Solar) Power Entity IDs ---
# These are used to measure current solar power generation. Add or remove as needed.
PV1_POWER_ENTITY_ID=sensor.your_pv1_power_sensor
PV2_POWER_ENTITY_ID=sensor.your_pv2_power_sensor
PV3_POWER_ENTITY_ID=sensor.your_pv3_power_sensor

# --- Debugging ---
# Set to "1" to enable detailed logging of feature vectors and model decisions.
# Set to "0" or remove for normal operation.
DEBUG=0

# --- Model Confidence ---
# The model uses a normalized confidence in range (0..1], where 1.0 means
# perfect agreement between trees (σ = 0 °C). The code maps σ (per-tree
# standard deviation in °C) to confidence via:
#   confidence = 1.0 / (1.0 + sigma)
# To pick a threshold: decide the maximum tolerated σ (°C) and convert:
#   threshold = 1.0 / (1.0 + sigma_max)
# Example: tolerate σ_max = 1.0°C -> CONFIDENCE_THRESHOLD = 0.5
CONFIDENCE_THRESHOLD=0.5

# --- Tuning ---
# The smoothing factor for the exponential moving average applied to the
# model's temperature predictions. A lower value (e.g., 0.1) results in
# more aggressive smoothing and less volatile output. A higher value (e.g., 0.8)
# makes the output more responsive to the latest raw prediction.
SMOOTHING_ALPHA=0.3

# InfluxDB bucket for exporting feature importances
INFLUX_FEATURES_BUCKET=ml_heating_features
